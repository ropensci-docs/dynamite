<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Priors for dynamic multivariate panel models • dynamite</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Priors for dynamic multivariate panel models">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">dynamite</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.5.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../articles/dynamite.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/dynamite_custom.html">Model customization and non-MCMC estimation with dynamite</a></li>
    <li><a class="dropdown-item" href="../articles/dynamite_priors.html">Priors for dynamic multivariate panel models</a></li>
    <li><a class="dropdown-item" href="../articles/dynamite_simulation.html">Simulating data from a dynamic multivariate panel model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/dynamite/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Priors for dynamic multivariate panel models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/dynamite/blob/master/vignettes/dynamite_priors.Rmd" class="external-link"><code>vignettes/dynamite_priors.Rmd</code></a></small>
      <div class="d-none name"><code>dynamite_priors.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="default-prior-distributions-in-dynamite">
<span class="header-section-number">1</span> Default prior distributions in dynamite<a class="anchor" aria-label="anchor" href="#default-prior-distributions-in-dynamite"></a>
</h2>
<p>The default priors in <code>dynamite</code> are chosen to be relatively uninformative (i.e., weakly informative) such that they provide computational stability by slightly regularizing the posterior. The motivation behind the default priors is thus similar to other popular Stan-based R packages such as <code>brms</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://CRAN.R-project.org/package=brms" class="external-link uri"&gt;https://CRAN.R-project.org/package=brms&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> and <code>rstanarm</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://CRAN.R-project.org/package=rstanarm" class="external-link uri"&gt;https://CRAN.R-project.org/package=rstanarm&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>.</p>
<p>Define <span class="math inline">\(\sigma_x=\max(1, \text{SD}(x))\)</span>, where <span class="math inline">\(\mbox{SD}(x)\)</span> is the standard deviation of the predictor variable <span class="math inline">\(x\)</span> over groups and non-fixed time points (see section “Lagged responses and predictors” in the main vignette for more information: <code><a href="../articles/dynamite.html">vignette("dynamite", package = "dynamite")</a></code>). Define also
<span class="math display">\[
\sigma_y = \begin{cases}
\max(1, \text{SD}(y)), &amp;\text{if family is gaussian or student}\\
1, &amp;\text{otherwise}
\end{cases},
\]</span>
where <span class="math inline">\(\mbox{SD}(y)\)</span> is the standard deviation of the response variable as over groups and non-fixed time points.</p>
<div class="section level3" number="1.1">
<h3 id="regression-coefficients">
<span class="header-section-number">1.1</span> Regression coefficients<a class="anchor" aria-label="anchor" href="#regression-coefficients"></a>
</h3>
<p>We define the default prior for a time-invariant regression coefficients <span class="math inline">\(\beta\)</span> as well for the first time-varying coefficient <span class="math inline">\(\delta_1\)</span> as zero-mean normal distribution with standard deviation of
<span class="math inline">\(2\sigma_y/\sigma_x\)</span>. The two maximums used in definitions of <span class="math inline">\(\sigma_y\)</span> and <span class="math inline">\(\sigma_x\)</span> ensure that the prior standard deviation is at least 2.</p>
</div>
<div class="section level3" number="1.2">
<h3 id="intercept">
<span class="header-section-number">1.2</span> Intercept<a class="anchor" aria-label="anchor" href="#intercept"></a>
</h3>
<p>As the posterior correlations between the intercept <span class="math inline">\(\alpha\)</span> and the regression coefficients <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\delta\)</span> can be cause computational inefficiencies with gradient-based sampling algorithms of Stan, sampling of the intercept is performed indirectly via parameter <span class="math inline">\(a\)</span>, so that the intercept <span class="math inline">\(\alpha\)</span> (or <span class="math inline">\(\alpha_1\)</span> in case of time-varying intercept) is constructed as
<span class="math display">\[
\alpha = a - \bar X^\beta_1\beta - \bar X_1^\delta\delta_1,
\]</span>
where <span class="math inline">\(\bar X^\beta\)</span> and <span class="math inline">\(\bar X^\delta\)</span> are the means of the corresponding predictors at first (non-fixed) time point. The prior is then defined for <span class="math inline">\(a\)</span> as
<span class="math display">\[
a \sim \mbox{N}(\bar y, 2\sigma_y),
\]</span>
where <span class="math inline">\(\bar y\)</span> is mean of the response variable values at first time point after applying the link function (except in case of categorical and multinomial response where <span class="math inline">\(\bar y\)</span> is set to zero).</p>
</div>
<div class="section level3" number="1.3">
<h3 id="standard-deviation-parameters">
<span class="header-section-number">1.3</span> Standard deviation parameters<a class="anchor" aria-label="anchor" href="#standard-deviation-parameters"></a>
</h3>
<p>The prior for the standard deviation parameter <span class="math inline">\(\tau\)</span> of the random walk prior of the spline coefficients is half-normal with the standard deviation of <span class="math inline">\(2\sigma_y/\sigma_x\)</span> (with <span class="math inline">\(\sigma_x=1\)</span> in case of a time-varying intercept). The same prior distribution is also used for the the standard deviations of the random effects. Note that this prior can be too uninformative in some cases especially for the <span class="math inline">\(\tau\)</span> parameters. A boundary (zero) avoiding <span class="math inline">\(Gamma(2, z)\)</span> prior with suitable value of <span class="math inline">\(z\)</span> can often work better for <span class="math inline">\(\tau\)</span> when the default prior leads to divergences (alternatively, in some occasions switching between centered and noncentered parameterization in <code>splines</code> can help).</p>
</div>
<div class="section level3" number="1.4">
<h3 id="correlation-matrices">
<span class="header-section-number">1.4</span> Correlation matrices<a class="anchor" aria-label="anchor" href="#correlation-matrices"></a>
</h3>
<p>The correlation matrix of the random effects and latent factors uses a <span class="math inline">\(\mbox{LKJ}(1)\)</span> prior with the Cholesky parameterization, see Stan documentation of <code>lkj_corr_cholesky</code> for details<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://mc-stan.org/docs/functions-reference/cholesky-lkj-correlation-distribution.html" class="external-link uri"&gt;https://mc-stan.org/docs/functions-reference/cholesky-lkj-correlation-distribution.html&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a>. The default corresponds to uniform distribution over valid correlation matrices.</p>
</div>
<div class="section level3" number="1.5">
<h3 id="parameters-related-to-latent-factors">
<span class="header-section-number">1.5</span> Parameters related to latent factors<a class="anchor" aria-label="anchor" href="#parameters-related-to-latent-factors"></a>
</h3>
<p>When defining latent factor term with <code>nonzero_lambda = TRUE</code>, priors are set for <span class="math inline">\(\zeta\)</span> and <span class="math inline">\(\kappa\)</span>, with defaults <span class="math inline">\(\kappa \sim N(0, 1)\)</span> and <span class="math inline">\(\kappa \sim Beta(2, 2)\)</span>. These are used to define standard deviation <span class="math inline">\(\sigma_\lambda\)</span> of the loadings as <span class="math inline">\(\sigma_\lambda = \kappa \zeta\)</span>, and <span class="math inline">\(\tau_\psi = (1 - \kappa)\zeta\)</span>, the standard deviation of the random walk prior of <span class="math inline">\(\psi_t\)</span>.</p>
<p>In case where <code>nonzero_lambda = FALSE</code>, <span class="math inline">\(\tau_\psi\)</span> is fixed to one, and prior is set directly on $_$ as <span class="math inline">\(N(0, 1)\)</span>. In both cases, prior on first <span class="math inline">\(\psi_1 \sim N(0, 1)\)</span>.</p>
</div>
<div class="section level3" number="1.6">
<h3 id="family-specific-parameters">
<span class="header-section-number">1.6</span> Family-specific parameters<a class="anchor" aria-label="anchor" href="#family-specific-parameters"></a>
</h3>
<p>For standard deviation parameter of gaussian and student’s <span class="math inline">\(t\)</span> responses, we use exponential prior with a rate parameter <span class="math inline">\(\frac{1}{2\max(1,\sigma_y)}\)</span>. The degrees-of-freedom parameter of the student’s <span class="math inline">\(t\)</span>-distribution has a <span class="math inline">\(\mbox{Gamma}(2, 0.1)\)</span> prior, whereas for other family specific parameters we set <span class="math inline">\(\phi \sim \mbox{Exponential}(1)\)</span>.</p>
</div>
</div>
<div class="section level2" number="2">
<h2 id="defining-priors-of-dynamite-models">
<span class="header-section-number">2</span> Defining priors of dynamite models<a class="anchor" aria-label="anchor" href="#defining-priors-of-dynamite-models"></a>
</h2>
<p>While <code><a href="../reference/dynamite.html">dynamite()</a></code> can be used with the default prior choices, we recommend to check whether the defaults make sense for your particular problem and to codify them accordingly based on the domain knowledge.</p>
<p>Any univariate unbounded continuous distributions supported by Stan can be used as a prior for univariate model parameters (in case the parameter is constrained to be positive, the distribution is automatically truncated). Naturally, any univariate distribution bounded to the positive real line can be used as a prior for parameters constrained to be positive (e.g., a standard deviation parameter).
See the Stan function reference at for possible distributions. For custom priors, you should first get the default priors with the <code><a href="../reference/get_priors.html">get_priors()</a></code> function, and then modify the <code>priors</code> column of the obtained data frame before supplying it to the <code><a href="../reference/dynamite.html">dynamite()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dynamiteformula.html">obs</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu">varying</span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">random</span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span>, <span class="st">"gaussian"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/random_spec.html">random_spec</a></span><span class="op">(</span>correlated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/splines.html">splines</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_priors.html">get_priors</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">gaussian_example</span>, time <span class="op">=</span> <span class="st">"time"</span>, group <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">p</span></span>
<span><span class="co">#&gt;           parameter response                prior      type category</span></span>
<span><span class="co">#&gt; 1  sigma_nu_y_alpha        y       normal(0, 3.1)  sigma_nu         </span></span>
<span><span class="co">#&gt; 2      sigma_nu_y_z        y       normal(0, 3.1)  sigma_nu         </span></span>
<span><span class="co">#&gt; 3           alpha_y        y     normal(1.5, 3.1)     alpha         </span></span>
<span><span class="co">#&gt; 4       tau_alpha_y        y       normal(0, 3.1) tau_alpha         </span></span>
<span><span class="co">#&gt; 5          beta_y_z        y       normal(0, 3.1)      beta         </span></span>
<span><span class="co">#&gt; 6         delta_y_x        y       normal(0, 3.1)     delta         </span></span>
<span><span class="co">#&gt; 7    delta_y_y_lag1        y       normal(0, 1.8)     delta         </span></span>
<span><span class="co">#&gt; 8           tau_y_x        y       normal(0, 3.1)       tau         </span></span>
<span><span class="co">#&gt; 9      tau_y_y_lag1        y       normal(0, 1.8)       tau         </span></span>
<span><span class="co">#&gt; 10          sigma_y        y    exponential(0.65)     sigma         </span></span>
<span><span class="co">#&gt; 11             L_nu          lkj_corr_cholesky(1)         L</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="va">prior</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"sigma_nu"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"normal(0, 1)"</span> <span class="co"># change prior for sigma_nu</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">prior</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"sigma_y"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"student_t(3, 0, 2)"</span> <span class="co"># prior for sigma_y</span></span>
<span><span class="va">p</span></span>
<span><span class="co">#&gt;           parameter response                prior      type category</span></span>
<span><span class="co">#&gt; 1  sigma_nu_y_alpha        y         normal(0, 1)  sigma_nu         </span></span>
<span><span class="co">#&gt; 2      sigma_nu_y_z        y         normal(0, 1)  sigma_nu         </span></span>
<span><span class="co">#&gt; 3           alpha_y        y     normal(1.5, 3.1)     alpha         </span></span>
<span><span class="co">#&gt; 4       tau_alpha_y        y       normal(0, 3.1) tau_alpha         </span></span>
<span><span class="co">#&gt; 5          beta_y_z        y       normal(0, 3.1)      beta         </span></span>
<span><span class="co">#&gt; 6         delta_y_x        y       normal(0, 3.1)     delta         </span></span>
<span><span class="co">#&gt; 7    delta_y_y_lag1        y       normal(0, 1.8)     delta         </span></span>
<span><span class="co">#&gt; 8           tau_y_x        y       normal(0, 3.1)       tau         </span></span>
<span><span class="co">#&gt; 9      tau_y_y_lag1        y       normal(0, 1.8)       tau         </span></span>
<span><span class="co">#&gt; 10          sigma_y        y   student_t(3, 0, 2)     sigma         </span></span>
<span><span class="co">#&gt; 11             L_nu          lkj_corr_cholesky(1)         L</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dynamite.html">dynamite</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">gaussian_example</span>, time <span class="op">=</span> <span class="st">"time"</span>,  group <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                priors <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
